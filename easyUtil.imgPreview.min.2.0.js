/*
 * (c) Copyright 2018 QiYan. All Rights Reserved.
 * **/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define(t):"function"==typeof define?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.easy_ImgPre=t()}("undefined"!=typeof window?window:void 0,function(){function e(e,t,n,i){this.div=document.querySelector("#"+e),t&&(this.elfiles=document.querySelector("#"+t)),this.fragment=document.createDocumentFragment(),this.files=null,this.img_files=[],this.no_pic=0,this.multiple=n,this.fn=i}function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.main_id,i=void 0===n?null:n,r=t.input_id,o=void 0===r?null:r,a=t.multiple,s=void 0===a||a,u=t.two_methods,d=void 0!==u&&u,f=t.fn,l=void 0===f?function(){}:f;if(!i)throw new Error("At least! The param “main_id” must be having here!! Otherwise, this method will be DOA!!! ");if(d&&!o)throw new Error(" Using both drag and input_file methods must be having an “input_id” !! ");var c=new e(i,o,s,l);switch(!0){case d:return c.all();case null!=o:return c.inputFile();default:return c.drag()}}var n=/^image\//;return e.prototype={constructor:e,inputFile:function(){var e=this;this.elfiles.addEventListener("change",function(){e.no_pic=0,e.files=e.elfiles.files,e.readerImg()})},drag:function(){var e=this;document.addEventListener("dragenter",function(t){e.no_pic=0}),document.addEventListener("dragover",function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation()}),this.div.ondragleave=function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation()},this.div.ondrop=function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation(),e.files=t.dataTransfer.files,e.readerImg()}},all:function(){this.drag(),this.inputFile()},readerImg:function(){var e=this,t=this.getImg();!function n(i,r){void 0===r&&(r=new FileReader),i.done?e.toResult():i.value.then(function(i){e.validate(i)?(r.onload=function(i){var o=document.createElement("img");o.src=i.target.result,e.fragment.appendChild(o),n(t.next(),r)},r.readAsDataURL(i),e.img_files.push(i)):(e.no_pic++,n(t.next(),r))}).catch(function(e){return alert(e)})}(t.next())},getImg:regeneratorRuntime.mark(function e(){var t,n,i,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this,n=regeneratorRuntime.mark(function e(n){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.files[n],e.next=3,new Promise(function(e,t){window.FileReader?e(i):t("浏览器暂不支持预览!")});case 3:case"end":return e.stop()}},e,r)}),i=0;case 3:if(!(i<t.files.length)){e.next=8;break}return e.delegateYield(n(i),"t0",5);case 5:i++,e.next=3;break;case 8:case"end":return e.stop()}},e,this)}),toResult:function(){this.multiple||(this.div.innerHTML="");var e=document.getElementById("no_pic");null!=e&&this.div.removeChild(e),this.div.appendChild(this.fragment);var t=this.no_pic;if(t){var n=document.createElement("div");n.style.color="red",n.id="no_pic",n.innerHTML="本次上传有"+t+"个文件非图片!",this.div.appendChild(n)}this.fn(this.img_files),this.img_files=[]},validate:function(e){return n.test(e.type)}},{init:t}});