/*
 * (c) Copyright 2018 QiYan. All Rights Reserved.
 * **/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"function"==typeof define&&define.amd?define(t):"function"==typeof define?define(t):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=t():e.easy_ImgPre=t()}("undefined"!=typeof window?window:void 0,function(){function e(e,t,i,n){this.div=document.querySelector("#"+e),t&&(this.elfiles=document.querySelector("#"+t)),this.fragment=document.createDocumentFragment(),this.files=null,this.img_files=[],this.no_pic=0,this.multiple=i,this.fn=n}function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.main_id,n=void 0===i?null:i,o=t.input_id,r=void 0===o?null:o,d=t.multiple,l=void 0===d||d,s=t.two_method,a=void 0!==s&&s,f=t.fn,u=void 0===f?function(){}:f;if(!n)throw new Error("At least! The param “main_id” must be having here!! Otherwise, this method will be DOA!!! ");if(a&&!r)throw new Error(" Using both drag and input_file methods must be having an “input_id” !! ");var p=new e(n,r,l,u);switch(!0){case a:return p.all();case null!=r:return p.inputFile();default:return console.log(r),p.drag()}}var i=/^image\//;return e.prototype={constructor:e,inputFile:function(){var e=this;this.elfiles.addEventListener("change",function(){e.no_pic=0,e.files=e.elfiles.files,e.readerImg()})},drag:function(){var e=this;document.addEventListener("dragenter",function(t){e.no_pic=0}),document.addEventListener("dragover",function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation()}),this.div.ondragleave=function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation()},this.div.ondrop=function(t){e.no_pic=0,t.preventDefault(),t.stopPropagation(),e.files=t.dataTransfer.files,e.readerImg()}},all:function(){this.drag(),this.inputFile()},readerImg:function(){if(window.FileReader){var e=new FileReader,t=this.files.length;this.loopHandleImg(e,0,t)}else this.div.innerHTML="浏览器暂不支持预览!"},loopHandleImg:function(e,t,i){if(t==i)return void this.toResult();var n=this.files[t],o=this;this.validate(n)?(this.img_files.push(n),e.onload=function(n){var r=document.createElement("img");r.src=n.target.result,o.fragment.appendChild(r),t++,o.loopHandleImg(e,t,i)},e.readAsDataURL(n)):(this.no_pic++,t++,this.loopHandleImg(e,t,i))},toResult:function(){this.multiple||(this.div.innerHTML="");var e=document.getElementById("no_pic");null!=e&&this.div.removeChild(e),this.div.appendChild(this.fragment);var t=this.no_pic;if(t){var i=document.createElement("div");i.style.color="red",i.id="no_pic",i.innerHTML="本次上传有"+t+"个文件非图片!",this.div.appendChild(i)}this.fn(this.img_files),this.img_files=[]},validate:function(e){return i.test(e.type)&&(e.name.indexOf("jpg")||e.name.indexOf("jpeg")||e.name.indexOf("png"))}},{init:t}});